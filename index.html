<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì˜¤ëŠ˜ì˜ ë…¸ë˜ì¶”ì²œ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>ì˜¤ëŠ˜ì˜ ë…¸ë˜ì¶”ì²œ</h1>

    <!-- ê¸°ë¶„ì— ë”°ë¼ ë°”ë€ŒëŠ” ì´ë¯¸ì§€ -->
    <img class="image-banner" id="moodImage" src="image/image2.png" alt="ë…¸ë˜ ë¶„ìœ„ê¸° ì´ë¯¸ì§€" />

    <form id="recommendForm">
      <div class="form-row">
        <div class="input-with-emoji">
          <input type="text" id="weather" name="weather" placeholder="ì§ì ‘ì…ë ¥ê°€ëŠ¥" autocomplete="off" required />
          <div class="emoji-dropdown" id="weatherEmoji">
            <span data-value="ë§‘ìŒ">â˜€ï¸</span>
            <span data-value="ë¹„">ğŸŒ§ï¸</span>
            <span data-value="íë¦¼">â˜ï¸</span>
            <span data-value="ë°”ëŒ">ğŸŒ¬ï¸</span>
          </div>
        </div>

        <div class="input-with-emoji">
          <input type="text" id="mood" name="mood" placeholder="ì§ì ‘ì…ë ¥ê°€ëŠ¥" autocomplete="off" required />
          <div class="emoji-dropdown" id="moodEmoji">
            <span data-value="í–‰ë³µ">ğŸ˜Š</span>
            <span data-value="ìš°ìš¸">ğŸ˜</span>
            <span data-value="ì§œì¦">ğŸ˜ </span>
            <span data-value="í”¼ê³¤">ğŸ¥±</span>
          </div>
        </div>
      </div>

      <button type="submit" class="round-button">í™•ì¸</button>
    </form>

    <h3>ì˜¤ëŠ˜ì˜ ë…¸ë˜</h3>
    <div id="result"></div>
  </div>

  <script>
    const ENDPOINT = "https://assign2-fccem5ud8-youngahkims-projects.vercel.app/api/duksungAI";
    
    function setupEmojiInput(inputId, dropdownId, callback) {
      const input = document.getElementById(inputId);
      const dropdown = document.getElementById(dropdownId);

      input.addEventListener("focus", () => {
        dropdown.style.display = "flex";
      });

      dropdown.querySelectorAll("span").forEach(span => {
        span.addEventListener("click", () => {
          input.value = span.dataset.value;
          dropdown.style.display = "none";
          if (callback) callback(span.dataset.value);
        });
      });

      document.addEventListener("click", (e) => {
        if (!dropdown.contains(e.target) && e.target !== input) {
          dropdown.style.display = "none";
        }
      });
    }

    function updateMoodImage(mood) {
  const moodImage = document.getElementById("moodImage");
  const moodMap = {
  "í–‰ë³µ": "image/image3.png",
  "ìš°ìš¸": "image/image4.png",
  "ì§œì¦": "image/image5.png",
  "í”¼ê³¤": "image/image6.png"
};

  const cleanMood = mood.trim();

  if (moodMap.hasOwnProperty(cleanMood)) {
    moodImage.src = moodMap[cleanMood];
  } else {
    moodImage.src = "image/image2.png"; 
  }
}

    setupEmojiInput("weather", "weatherEmoji");
    setupEmojiInput("mood", "moodEmoji", updateMoodImage);
    const moodInput = document.getElementById("mood");
    moodInput.addEventListener("input", () => {
    const value = moodInput.value.trim();
    updateMoodImage(value);
    });

    const form = document.getElementById("recommendForm");
    const resultDiv = document.getElementById("result");

    form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const weather = document.getElementById("weather").value;
    const mood    = document.getElementById("mood").value;

          try {
      /* ì—¬ê¸° fetch ê²½ë¡œë¥¼ ENDPOINT ë¡œ êµì²´ */
      const response = await fetch(ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ weather, mood })
      });

      const data = await response.json();
      resultDiv.textContent = data.answer || "âš ï¸ " + data.error;
    } catch (err) {
      resultDiv.textContent = "âš ï¸ ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨";
      console.error(err);
    }
  });
</script>
</body>
</html>
